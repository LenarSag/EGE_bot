# ЕГЭ Бот

## Описание проекта

Этот проект представляет собой Telegram-бота для сбора баллов ЕГЭ учеников. Бот позволяет ученикам зарегистрироваться, вводить свои баллы по предметам и просматривать их.

## Функции бота

- **Регистрация ученика**: Бот принимает имя и фамилию ученика, сохраняет информацию в базе данных.
- **Ввод баллов ЕГЭ**: Ученики могут вводить свои баллы по различным предметам, которые сохраняются в базе данных и связываются с учеником.
- **Просмотр баллов**: Бот позволяет ученикам просматривать свои сохраненные баллы ЕГЭ.

## Команды бота

- `/start`: Приветствие пользователя и предложение зарегистрироваться или войти.
- `/register`: Запрос имени и фамилии ученика для регистрации.
- `/enter_scores`: Возможность ввести баллы ЕГЭ и сохранить их в базе данных.
- `/view_scores`: Просмотр сохраненных баллов ЕГЭ.

## Стек технологий

- **Aiogram**: Для создания Telegram-бота.
- **SQLAlchemy**: Для работы с базой данных.
- **Alembic**: Для миграций базы данных.
- **Docker**: Для контейнеризации приложения.

## Установка и запуск

1. Клонируйте репозиторий:

   ```bash
   git clone https://github.com/LenarSag/EGE_bot
   cd EGE_bot
   ```

2. Установите зависимости:

   ```bash
   pip install -r requirements.txt
   ```

3. Создайте файл `.env` и добавьте ваш Telegram токен:

   ```env
   TELEGRAM_TOKEN=ваш_токен_бота
   DB_URL=postgresql+asyncpg://postgres:password@db:5432/postgres
   ```

4. Запустите проект с помощью Docker:

   ```bash
   docker-compose up --build
   ```

## Как выполнить миграции Alembic

Миграции следует выполнять **внутри контейнера**.

1. **Настройка Alembic**

   Убедитесь, что в вашем проекте есть папка `alembic/` и файл `alembic.ini`. Если они отсутствуют, выполните команду для инициализации Alembic:

   ```bash
   docker-compose exec app alembic init alembic
   ```

   Это создаст базовую структуру для работы с миграциями.

2. **Настройка подключения к базе данных**

   В файле `alembic.ini` найдите строку с параметром `sqlalchemy.url` и замените его на строку подключения к вашей базе данных:

   ```ini
   sqlalchemy.url = postgresql+asyncpg://postgres:password@db:5432/postgres
   ```

   Убедитесь, что вы используете правильные данные для подключения, такие как имя пользователя, пароль и адрес базы данных.

3. **Создание миграций**

   После того как вы настроили все параметры, можно создать миграцию для применения изменений в схеме базы данных. Для этого выполните команду **внутри контейнера**:

   ```bash
   docker-compose exec app alembic revision --autogenerate -m "Описание миграции"
   ```

   Команда сгенерирует файл миграции, который будет содержать изменения для синхронизации вашей базы данных с текущей моделью.

4. **Применение миграций**

   Для применения созданных миграций в базу данных выполните команду **внутри контейнера**:

   ```bash
   docker-compose exec app alembic upgrade head
   ```

   Эта команда применит все миграции до актуального состояния.

5. **Просмотр состояния миграций**

   Если вы хотите проверить, какие миграции уже были применены, используйте команду:

   ```bash
   docker-compose exec app alembic history --verbose
   ```

   Это отобразит историю миграций, включая их идентификаторы и описание.

6. **Откат миграций**

   Если необходимо откатить миграцию, можно использовать команду:

   ```bash
   docker-compose exec app alembic downgrade <имя_миграции>
   ```

   Например, чтобы откатить на одну миграцию назад, используйте:

   ```bash
   docker-compose exec app alembic downgrade -1
   ```

